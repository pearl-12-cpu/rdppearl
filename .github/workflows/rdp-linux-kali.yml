
name: Kali-RDP-Mobile

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'Runtime in minutes (max 360)'
        required: false
        default: '180'

jobs:
  kali-rdp:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Setup Ubuntu Desktop with Security Tools
        run: |
          set -e
          echo "üîß Starting installation process..."
          
          # Add necessary repositories
          sudo add-apt-repository universe -y
          sudo add-apt-repository multiverse -y
          sudo apt-get update
          
          # Install desktop environment
          echo "üìÄ Installing desktop environment..."
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y \
            xfce4 xfce4-goodies \
            xrdp \
            firefox \
            nano vim curl wget unzip git

          # Install security tools that WORK
          echo "üõ†Ô∏è Installing security tools..."
          sudo apt-get install -y \
            nmap nikto sqlmap gobuster dirb ffuf \
            python3 python3-pip python3-venv \
            john hashcat hydra wireshark tcpdump \
            netcat-openbsd

          # Create user
          sudo useradd -m -s /bin/bash kali 2>/dev/null || true
          echo "kali:kali123456" | sudo chpasswd
          sudo usermod -aG sudo kali

          # Configure xrdp
          sudo sed -i 's/port=3389/port=3390/g' /etc/xrdp/xrdp.ini
          echo "xfce4-session" | sudo tee /etc/xrdp/startwm.sh
          sudo chmod +x /etc/xrdp/startwm.sh

          # Start RDP service
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

          echo "‚úÖ Desktop environment ready!"

      - name: Install Additional Python Tools
        run: |
          pip3 install requests bs4 scrapy
          echo "‚úÖ Python tools installed"

      - name: Setup Ngrok Tunnel (RELIABLE RDP Access)
        env:
          NGROK_TOKEN: ${{ secrets.NGROK_TOKEN }}
        run: |
          echo "üåê Setting up Ngrok tunnel (more reliable than Playit)..."
          
          # Download and install ngrok
          wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
          tar -xzf ngrok-v3-stable-linux-amd64.tgz
          chmod +x ngrok
          
          # Authenticate ngrok
          ./ngrok config add-authtoken "$NGROK_TOKEN"
          
          # Start ngrok tunnel for RDP
          ./ngrok tcp 3390 --log=stdout > ngrok.log 2>&1 &
          echo "‚è≥ Waiting for tunnel to establish..."
          sleep 10
          
          # Get the public URL
          NGROK_URL=$(curl -s http://localhost:4040/api/tunnels | grep -o 'tcp://[^"]*\.ngrok.io:[0-9]*' | head -1)
          
          if [ -n "$NGROK_URL" ]; then
            echo "üéØ RDP Connection Details:" 
            echo "Address: $NGROK_URL"
            echo "Username: kali"
            echo "Password: kali123456"
            echo "üì± Use Windows RDP app on your phone to connect!"
            echo ""
            echo "üîó In your RDP app, use: $(echo $NGROK_URL | sed 's/tcp:\/\///' | cut -d: -f1)"
            echo "üî¢ Port: $(echo $NGROK_URL | cut -d: -f3)"
          else
            echo "‚ùå Failed to get Ngrok URL"
            echo "üìã Ngrok log:"
            cat ngrok.log
            exit 1
          fi

      - name: Keep Alive with Countdown
        run: |
          DURATION=${{ github.event.inputs.duration || 180 }}
          echo "üïê RDP session active for $DURATION minutes"
          echo "üîß Tools available: nmap, sqlmap, ffuf, gobuster, wireshark, john, hashcat, etc."
          echo ""
          echo "üí° The RDP tunnel is active! Connect from your phone now."
          
          MINUTES=$DURATION
          for ((i=MINUTES; i>0; i--)); do
            echo "‚è≥ Time remaining: ${i} minutes"
            sleep 60
          done
          echo "‚ùå Session ending now"
